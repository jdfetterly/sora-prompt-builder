---
alwaysApply: true
---
# Sora Prompting Engine — Spec-Driven Development Rules

## 1. Core Principle
Every design, component, or feature **must trace back to the PRD or Design Spec**.
Nothing is built without a corresponding requirement (e.g., `F-1.5`).

> "Spec → Design → Build → Validate" — not the reverse.

---

## 2. Source of Truth
- `/docs/PRD.md` defines WHAT the product does.  
- `/docs/DesignSpec.md` defines HOW it looks and feels.  
- `/docs/API.md` defines the data and integration contracts.  
- `/docs/Architecture.md` defines where each function lives.

All changes originate in `/docs/` before implementation.  
Cursor Agent should always **read or summarize specs** before generating code.

---

## 3. Traceability & Tagging
Each commit or PR must reference the PRD section or Feature ID, e.g.:

```
feat(F-1.5): add AI Co-pilot API route
fix(F-3): update Firestore draft autosave logic
```

Cursor Agent should include this tag in commit messages automatically.

---

## 4. Folder Governance
- `/frontend/` → UI + API routes only.  
- `/backend/` → Firebase functions and schema.  
- `/docs/` → Specs, data models, and architecture.  
- `/design/` → Visual assets, not logic.  
- `/scripts/` → Automation or deployment tasks only.

Cursor Agent may only modify files within the relevant domain.

---

## 5. Build Flow (Agent Checklist)
Before building or editing any feature:
1. Parse `/docs/PRD.md` for matching Feature ID (e.g., F-7 Registration Gate).  
2. Confirm spec details and required data inputs.  
3. Check `/docs/API.md` for data model references.  
4. Implement change within correct folder.  
5. Update `/docs/Architecture.md` to reflect new component or API route.

---

## 6. Code Quality & Conventions
- Use **TypeScript** and **strict mode**.  
- Use **TailwindCSS** for styling — no inline styles.  
- Always export functional React components using PascalCase.  
- API routes must validate Firebase ID tokens for protected actions.  
- Firestore reads/writes go through helper functions in `/frontend/lib/`.

Cursor Agent should infer context and respect these conventions automatically.

---

## 7. LLM & Agent Integration
- The OpenAI **Agent ID** is stored in `.env.local`.  
- `/app/api/copilot/route.ts` handles the entire interface.  
- No direct OpenAI API calls from components.  
- If agent schema changes, update `/docs/API.md` and `/frontend/lib/openai.ts`.

---

## 8. Documentation Discipline
When a new feature is added or modified:
- Update `/docs/PRD.md` if the requirement changes.
- Update `/docs/DesignSpec.md` if UI or flow changes.
- Update `/docs/Architecture.md` to reflect file paths.
- Increment version number in PRD header.

Cursor Agent should remind contributors to document changes before merging.

---

## 9. Review & Validation
Before deployment, confirm:
- Each PRD item has a corresponding implementation path.
- No code exists without an associated feature tag.
- Tests and logging align with the spec’s success metrics.

---

## 10. Cursor Agent Behavior Rules
- Always **read docs before generating code**.
- Never modify `/docs/` content unless explicitly requested.
- Never create new features not defined in the PRD.
- Always maintain traceability (feature ID comments, commits, and file headers).
- Always propose updates to `/docs/Architecture.md` after structural edits.

---

## 11. Example File Header (Auto-Insert)
Each new file generated by the Cursor Agent should begin with:

```typescript
/**
 * @FeatureID F-1.5
 * @Purpose Implements AI Co-pilot endpoint for registered users.
 * @Spec /docs/PRD.md#F-1.5
 * @Author Chat Bot Labs
 */
```
